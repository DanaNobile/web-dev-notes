# Exploring the Prisma GraphQL API
* No more installation or configuration left
* The Prisma GraphQL API is autogenerated for us and allows us to interact with our DB
    - As we perform Mutations we are writing to our DB
    - As we perform Queries and Subscriptions we are reading from our DB
    - The Prisma GraphQL API Mutation, Queries and Subscriptions automatically get generated based on the contents of our datamodel.prisma file

## Time to Code - Let's create a new user
* The first time I did this it did not work - got an internal error
* I deleted the prisma folder
* `$ prisma init prisma`
* `$ docker-compose up -d`
* `$ prisma deploy`
* Opened the browser to: `http://localhost:4466/`
* Added this createUser:

```
mutation {
  createUser(data: { name: "Joee" }) {
    id
    name
  }
}
```

* Response

```
{
  "data": {
    "createUser": {
      "id": "cjwpxaw42000k07921ej4a9a9",
      "name": "Joee"
    }
  }
}
```

* Than I wanted to add `createdAt` and `updatedAt` fields

```
type User {
  id: ID! @id
  name: String!
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}
```

* Redeploy with `$ prisma deploy`
* But that didn't work because I already had created a user without those fields so I wanted to delete the user I created

```
mutation {
  deleteUser(where: {
    id: "cjwpxaw42000k07921ej4a9a9"
  }) {
    id
  }
}
```

* Then run the `$ prisma deploy` again
* The fields were added:

```
User (Type)
  + Created field `createdAt` of type `DateTime!`
  + Created field `updatedAt` of type `DateTime!`
```

* The GraphQL we just ran is now storing the data in our PostGres DB
* The data has changed since we last used pgAdmin so we need to refresh it, right click `Schemas` and click **refresh**
    - We only need to refresh when we make a change to our data structure
* in pgAdmin 4 - I do not see a default$default schema but I do see it inside public, in the docker file I did comment out public schema but did not see a change, right click User table in public and view all to see the user that was created

![user inserted](https://i.imgur.com/yiMakFn.png)

* Refresh data by clicking on lightning bolt in pgAdmin

Query all users in GraphQL Playground

```
query {
  users {
    id
    name
  }
}
```

## Update
```
mutation {
  updateUser(
    where: { id: "cjwpymsfs00c30851ize1zpc3" }
    data: { name: "Mommy" }
  ) {
    id
    name
  }
}
```

## Challenge
* Delete 2nd user

```
mutation {
  deleteUser(where:{
    id: "cjwpymsfs00c30851ize1zpc3"
  }) {
    id
    name
  }
}
```

Refresh pgAdmin and you should see the 2nd user was removed

## What if we switched to another DB?
* We don't have to change our GraphQL API because prisma abstracts about the DB code!

## Next
* Make our User type more realistic and practical
